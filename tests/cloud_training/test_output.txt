============================= test session starts ==============================
platform linux -- Python 3.10.6, pytest-8.3.3, pluggy-1.5.0 -- /home/smy154/.pyenv/versions/3.10.6/envs/taxifare-env/bin/python
cachedir: .pytest_cache
rootdir: /home/smy154/code/smy154/data-train-in-the-cloud/tests
configfile: pytest_kitt.ini
collecting ... collected 9 items / 1 deselected / 8 selected

tests/cloud_training/test_cloud_data.py::TestCloudData::test_big_query_dataset_variable_exists PASSED [ 12%]
tests/cloud_training/test_cloud_data.py::TestCloudData::test_cloud_data_create_dataset PASSED [ 25%]
tests/cloud_training/test_cloud_data.py::TestCloudData::test_cloud_data_create_table PASSED [ 37%]
tests/cloud_training/test_main.py::TestMain::test_route_preprocess PASSED [ 50%]
tests/cloud_training/test_main.py::TestMain::test_route_train[local] PASSED [ 62%]
tests/cloud_training/test_main.py::TestMain::test_route_train[gcs] PASSED [ 75%]
tests/cloud_training/test_main.py::TestMain::test_route_evaluate FAILED  [ 87%]
tests/cloud_training/test_main.py::TestMain::test_route_pred PASSED      [100%]

=================================== FAILURES ===================================
_________________________ TestMain.test_route_evaluate _________________________

self = <tests.cloud_training.test_main.TestMain object at 0x7fee51a31300>

    @patch("taxifare.params.MODEL_TARGET", new='local')
    def test_route_evaluate(self):
        from taxifare.interface.main import evaluate
    
>       mae = evaluate(min_date=MIN_DATE, max_date=MAX_DATE)

tests/cloud_training/test_main.py:107: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
taxifare/interface/main.py:198: in evaluate
    data_processed = get_data_with_cache(
taxifare/ml_logic/data.py:58: in get_data_with_cache
    result = query_job.result()
../../../.pyenv/versions/3.10.6/envs/taxifare-env/lib/python3.10/site-packages/google/cloud/bigquery/job/query.py:1595: in result
    do_get_result()
../../../.pyenv/versions/3.10.6/envs/taxifare-env/lib/python3.10/site-packages/google/api_core/retry.py:283: in retry_wrapped_func
    return retry_target(
../../../.pyenv/versions/3.10.6/envs/taxifare-env/lib/python3.10/site-packages/google/api_core/retry.py:190: in retry_target
    return target()
../../../.pyenv/versions/3.10.6/envs/taxifare-env/lib/python3.10/site-packages/google/cloud/bigquery/job/query.py:1584: in do_get_result
    super(QueryJob, self).result(retry=retry, timeout=timeout)
../../../.pyenv/versions/3.10.6/envs/taxifare-env/lib/python3.10/site-packages/google/cloud/bigquery/job/base.py:971: in result
    return super(_AsyncJob, self).result(timeout=timeout, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = QueryJob<project=winter-quanta-437911-i4, location=EU, id=13a1fa82-9e8d-4d56-b651-4c074700aa5b>
timeout = None, retry = <google.api_core.retry.Retry object at 0x7fee51c9df60>

    def result(self, timeout=None, retry=DEFAULT_RETRY):
        """Get the result of the operation, blocking if necessary.
    
        Args:
            timeout (int):
                How long (in seconds) to wait for the operation to complete.
                If None, wait indefinitely.
    
        Returns:
            google.protobuf.Message: The Operation's result.
    
        Raises:
            google.api_core.GoogleAPICallError: If the operation errors or if
                the timeout is reached before the operation completes.
        """
        kwargs = {} if retry is DEFAULT_RETRY else {"retry": retry}
        self._blocking_poll(timeout=timeout, **kwargs)
    
        if self._exception is not None:
            # pylint: disable=raising-bad-type
            # Pylint doesn't recognize that this is valid in this case.
>           raise self._exception
E           google.api_core.exceptions.BadRequest: 400 Table winter-quanta-437911-i4.taxifare.processed_1k does not have a schema.; reason: invalid, message: Table winter-quanta-437911-i4.taxifare.processed_1k does not have a schema.
E           
E           Location: EU
E           Job ID: 13a1fa82-9e8d-4d56-b651-4c074700aa5b

../../../.pyenv/versions/3.10.6/envs/taxifare-env/lib/python3.10/site-packages/google/api_core/future/polling.py:137: BadRequest
----------------------------- Captured stdout call -----------------------------
[35m
‚≠êÔ∏è Use case: evaluate[0m
[34m
Load latest model from local registry...[0m
[34m
Load latest model from disk...[0m
‚úÖ Model loaded from local disk
[34m
Load data from BigQuery server...[0m
=========================== short test summary info ============================
FAILED tests/cloud_training/test_main.py::TestMain::test_route_evaluate - goo...
====== 1 failed, 7 passed, 1 deselected, 19 warnings in 156.18s (0:02:36) ======
